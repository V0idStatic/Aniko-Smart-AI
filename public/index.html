<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="Css/design.css">


    <title>Anikos</title>

</head>
<body>
    <div class="container">
        <h1>Aniko Smart Monitoring Systemss</h1>
        <p class="description">Sign in with your Google account to access all features</p>
        
        <button id="googleLoginBtn" class="login-button">
            <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" alt="Google Logo">
            Sign in with Google
        </button>
        
        <div id="loading" class="loading"></div>
        
        <div id="statusMessage" class="status"></div>
        
        <div id="userInfo" class="user-info">
            <img id="userAvatar" class="user-avatar" src="" alt="User Avatar">
            <h2>Welcome, <span id="userName"></span>!</h2>
            
            <div class="user-detail">
                <strong>Email:</strong> <span id="userEmail"></span>
            </div>
            <div class="user-detail">
                <strong>User ID:</strong> <span id="userId"></span>
            </div>
            
            <p id="dataSaveStatus" class="status success">Your data has been saved successfully!</p>
            
            <button id="logoutBtn" class="logout-button">Log Out</button>
        </div>
    </div>

    <!-- Load Firebase SDK from CDN -->
    <script type="module">
        // Import necessary functions from the Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";

        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCN8R8w5wSY6omSBbr8KOnEpXLQu_1aw18",
            authDomain: "aniko-smart-ai.firebaseapp.com",
            databaseURL: "https://aniko-smart-ai-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "aniko-smart-ai",
            storageBucket: "aniko-smart-ai.firebasestorage.app",
            messagingSenderId: "128929125916",
            appId: "1:128929125916:web:5f07d85d749af3034ab1d9",
            measurementId: "G-E39VS579EB"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);

        // Get DOM elements
        const googleLoginBtn = document.getElementById('googleLoginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const userInfo = document.getElementById('userInfo');
        const statusMessage = document.getElementById('statusMessage');
        const loading = document.getElementById('loading');
        const userName = document.getElementById('userName');
        const userEmail = document.getElementById('userEmail');
        const userId = document.getElementById('userId');
        const userAvatar = document.getElementById('userAvatar');
        const dataSaveStatus = document.getElementById('dataSaveStatus');

        // Function to show status messages
        function showStatus(message, isError = false) {
            statusMessage.textContent = message;
            statusMessage.className = isError ? 'status error' : 'status success';
            statusMessage.style.display = 'block';
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                statusMessage.style.display = 'none';
            }, 5000);
        }

        // Function to handle Google login
        function googleLogin() {
            loading.style.display = 'block';
            statusMessage.style.display = 'none';
            
            const provider = new GoogleAuthProvider();
            signInWithPopup(auth, provider)
                .then((result) => {
                    const user = result.user;
                    showUserInfo(user);
                    writeUserData(user.uid, user.displayName, user.email, user.photoURL);
                })
                .catch((error) => {
                    loading.style.display = 'none';
                    console.error("Login error:", error);
                    showStatus("Login failed: " + error.message, true);
                });
        }

        // Function to show user information
        function showUserInfo(user) {
            userName.textContent = user.displayName;
            userEmail.textContent = user.email;
            userId.textContent = user.uid;
            userAvatar.src = user.photoURL;
            
            userInfo.style.display = 'block';
            loading.style.display = 'none';
        }

        // Function to write user data to Firebase Realtime Database
        function writeUserData(userID, name, email, imageUrl) {
            const reference = ref(db, 'users/' + userID);
            set(reference, {
                username: name,
                email: email,
                profile_picture: imageUrl,
                last_login: new Date().toISOString()
            })
            .then(() => {
                dataSaveStatus.style.display = 'block';
                console.log('User data has been written successfully!');
            })
            .catch((error) => {
                console.error('Error writing data: ', error);
                showStatus('Error saving user data: ' + error.message, true);
            });
        }

        // Function to handle logout
        function handleLogout() {
            signOut(auth)
                .then(() => {
                    userInfo.style.display = 'none';
                    dataSaveStatus.style.display = 'none';
                    showStatus("You've been logged out successfully.");
                })
                .catch((error) => {
                    console.error("Logout error:", error);
                    showStatus("Logout failed: " + error.message, true);
                });
        }

        // Add event listeners
        googleLoginBtn.addEventListener('click', googleLogin);
        logoutBtn.addEventListener('click', handleLogout);

        // Check if user is already logged in
        auth.onAuthStateChanged((user) => {
            if (user) {
                showUserInfo(user);
            } else {
                loading.style.display = 'none';
            }
        });


    </script>
</body>
</html>